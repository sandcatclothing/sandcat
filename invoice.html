<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Invoice - SANDCAT</title>
  <link rel="stylesheet" href="style.css" />
  <style>
    .invoice-wrap{
      max-width: 920px; margin: 20px auto 100px auto;
      border: 1px solid #0f4; padding: 20px;
      background: #000; color: #00ff66; font-family: 'Courier New', monospace;
      box-shadow: 0 12px 36px rgba(0,255,102,.06);
      animation: fadeIn .45s ease both;
    }
    .invoice-head{ display:grid; grid-template-columns: 1fr auto; align-items:center; gap:20px; margin-bottom:16px; }
    .invoice-head .brand{ display:flex; align-items:center; gap:12px; }
    .invoice-head .brand img.logo{ height:60px; width:auto; object-fit:contain; filter: drop-shadow(0 0 6px rgba(0,255,102,.25)); }
    .invoice-meta{ border-top:1px dashed #0f4; border-bottom:1px dashed #0f4; padding:10px 0; margin:10px 0 16px 0; display:grid; gap:6px; }
    .invoice-grid{ display:grid; grid-template-columns: 1fr 1fr; gap:16px; margin: 14px 0 20px 0; }
    .card{ border:1px dashed #0f4; padding:12px; border-radius:6px; }
    .card label{ display:block; font-size:.85rem; color:#6aff9e; margin-bottom:4px; }
    .card input, .card textarea{
      width: 100%; background:#000; color:#00ff66; border:1px solid #0f4;
      padding: 8px; font-family: inherit; border-radius:6px; box-shadow: 0 0 12px rgba(0,255,102,.12) inset;
    }
    .items-table{ width:100%; border-collapse:collapse; margin-top:10px; }
    .items-table th, .items-table td{ border-bottom:1px dashed #0f4; padding:8px; text-align:left; }
    .items-table th{ color:#6aff9e; font-weight: normal; }
    .totals{ display:flex; justify-content:flex-end; margin-top:12px; }
    .totals .total-box{ border:1px solid #0f4; padding:10px 14px; min-width:240px; border-radius:6px; box-shadow: 0 8px 22px rgba(0,255,102,.08); }
    .actions{ display:flex; gap:10px; margin-top:16px; }
    @media print{
      body{ background:#fff !important; color:#000 !important; }
      .white-bar, .newsletter, .actions{ display:none !important; }
      .invoice-wrap{ border: 1px solid #ccc; background:#fff; color:#000; margin: 0; padding: 16px; box-shadow:none; }
      .items-table th, .items-table td{ border-bottom:1px solid #ccc; color:#000; }
      .card input, .card textarea{ background:#fff; color:#000; border:1px solid #ccc; }
    }
  </style>
</head>
<body>
  <div class="white-bar">
    <img src="assets/logo2.png" class="logo-left" onclick="window.location.href='index.html'" alt="logo" />
    <img src="assets/logo_text.png" class="logo-center" alt="SANDCAT" />
    <div class="top-icons">
      <img src="assets/bag.png" class="cart-icon" onclick="toggleCart()" alt="Cart" />
      <span class="cart-count" id="cart-count">0</span>
      <div class="hamburger" onclick="window.location.href='index.html'">☰</div>
    </div>
  </div>

  <div class="invoice-wrap">
    <div class="invoice-head">
      <div class="brand">
        <img src="assets/logo2.png" class="logo" alt="SANDCAT logo" />
        <div>
          <div style="font-size:1.2rem; font-weight:700;">SANDCAT</div>
          <div>sandcat.es</div>
        </div>
      </div>
      <div class="id">
        <div id="inv-id">Invoice: —</div>
        <div id="inv-date">Date: —</div>
      </div>
    </div>

    <div class="invoice-meta">
      <div>Payment status: <strong>CONFIRMED</strong></div>
      <div>Payment method: PayPal/COD</div>
    </div>

    <div class="invoice-grid">
      <div class="card">
        <label>Bill To (editable)</label>
        <input id="cust-name" placeholder="Full name" />
        <input id="cust-email" placeholder="Email" />
        <textarea id="cust-address" rows="3" placeholder="Address"></textarea>
        <input id="cust-vat" placeholder="VAT/NIF (optional)" />
      </div>
      <div class="card">
        <label>Seller</label>
        <div>SANDCAT</div>
        <div>support@sandcat.es</div>
        <div>sandcat.es</div>
      </div>
    </div>

    <table class="items-table" id="items-table">
      <thead>
        <tr>
          <th style="width:55%;">Item</th>
          <th style="width:15%;">Size</th>
          <th style="width:15%;">Price</th>
          <th style="width:15%;">Subtotal</th>
        </tr>
      </thead>
      <tbody id="items-body">
        <tr><td colspan="4">Loading last order…</td></tr>
      </tbody>
    </table>

    <div class="totals">
      <div class="total-box">
        <div>Subtotal: €<span id="t-sub">0.00</span></div>
        <div>Tax (0%): €<span id="t-tax">0.00</span></div>
        <div style="font-weight:700; margin-top:6px;">Total: €<span id="t-total">0.00</span></div>
      </div>
    </div>

    <div class="actions">
      <button onclick="window.print()">Print / Save PDF</button>
      <button onclick="saveCustomer()">Save Customer Data</button>
    </div>
  </div>

  <script src="script.js"></script>
  <script>
    updateCartCount();
    (function initInvoice(){
      const data = localStorage.getItem('last_order');
      const invId = document.getElementById('inv-id');
      const invDate = document.getElementById('inv-date');
      const tbody = document.getElementById('items-body');
      const tSub = document.getElementById('t-sub');
      const tTax = document.getElementById('t-tax');
      const tTotal = document.getElementById('t-total');

      if (!data) {
        tbody.innerHTML = '<tr><td colspan="4">No order found. Please complete a purchase.</td></tr>';
        invId.textContent = 'Invoice: —';
        invDate.textContent = 'Date: —';
        return;
      }

      const order = JSON.parse(data);
      invId.textContent = 'Invoice: ' + (order.orderId || '—');
      invDate.textContent = 'Date: ' + (order.createdAt ? new Date(order.createdAt).toLocaleString() : '—');

      if (order.customer) {
        document.getElementById('cust-name').value = order.customer.name || '';
        document.getElementById('cust-email').value = order.customer.email || '';
        document.getElementById('cust-address').value = order.customer.address || '';
        document.getElementById('cust-vat').value = order.customer.vatid || '';
      }

      if (!order.items || !order.items.length) {
        tbody.innerHTML = '<tr><td colspan="4">Order has no items.</td></tr>';
      } else {
        tbody.innerHTML = '';
        let subtotal = 0;
        order.items.forEach(it => {
          const price = Number(it.price) || 0;
          subtotal += price;
          const tr = document.createElement('tr');
          tr.innerHTML = `
            <td>${it.name || 'Product'}</td>
            <td>${it.size || 'N/A'}</td>
            <td>€${price.toFixed(2)}</td>
            <td>€${price.toFixed(2)}</td>
          `;
          tbody.appendChild(tr);
        });
        tSub.textContent = subtotal.toFixed(2);
        tTax.textContent = '0.00';
        tTotal.textContent = (Number(order.total) || subtotal).toFixed(2);
      }
    })();

    function saveCustomer(){
      const data = localStorage.getItem('last_order');
      if (!data) return alert('No order found.');
      const order = JSON.parse(data);
      order.customer = {
        name: document.getElementById('cust-name').value.trim(),
        email: document.getElementById('cust-email').value.trim(),
        address: document.getElementById('cust-address').value.trim(),
        vatid: document.getElementById('cust-vat').value.trim()
      };
      localStorage.setItem('last_order', JSON.stringify(order));
      alert('Customer data saved in this browser.');
    }
  </script>
</body>
</html>
